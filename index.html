<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Partagée - Vendredi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        h1 {
            text-align: center;
            padding: 20px 0;
            background-color: #007bff;
            color: white;
            margin-bottom: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
        }

        .search-bar-section, .filter-section, .tag-filter-section {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .search-bar-section label {
            margin-right: 10px;
            font-weight: bold;
        }

        .search-bar-section input[type="text"] {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .filter-section h2, .tag-filter-section h2 {
            margin-top: 0;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .filters, .tag-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: flex-start;
        }

        .filters label, .tag-filters label {
            cursor: pointer;
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 20px;
            background-color: #eee;
            color: #333;
            display: inline-block;
            margin-bottom: 5px;
        }

        .filters label.active, .tag-filters label.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        .filters input[type="radio"], .tag-filters input[type="radio"] {
            display: none;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            margin-bottom: 10px;
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Aligne checkbox/label à gauche, tag button à droite */
        }

        li:last-child {
            border-bottom: none;
        }

        li input[type="checkbox"] {
            margin-right: 10px;
        }

        li label {
            flex-grow: 1;
        }

        li button.tag-button {
            background: none;
            border: none;
            cursor: pointer;
            color: #007bff;
            font-size: 0.9em;
            padding: 5px 10px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        li button.tag-button:hover {
            background-color: #e0f7fa; /* Light hover background */
        }

        li .task-tags {
            margin-left: 10px;
            font-size: 0.8em;
            color: #777;
        }

        .hidden {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }

            .filters, .tag-filters {
                flex-direction: column;
                align-items: stretch;
            }

            .filters label, .tag-filters label {
                margin-bottom: 10px;
            }

            .search-bar-section {
                flex-direction: column;
                align-items: stretch;
            }

            .search-bar-section label {
                margin-bottom: 5px;
                margin-right: 0;
            }
        }

        /* Modal styles (optional, for tag input) */
        .tag-modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        .tag-modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
            border-radius: 5px;
        }

        .tag-modal-content input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .tag-modal-content button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .tag-modal-content button.save-tag {
            background-color: #007bff;
            color: white;
        }

        .tag-modal-content button.cancel-tag {
            background-color: #ccc;
            color: white;
            margin-left: 10px;
        }

    </style>
</head>
<body>
    <h1>Checklist Partagée - Vendredi</h1>

    <div class="container">

        <div class="tag-filter-section">
            <h2>Filtrer par tags</h2>
            <div class="tag-filters" id="tag-filters">
                <label for="tag-all">
                    <input type="radio" id="tag-all" name="tag-filter" value="all" checked> Tous les tags
                </label>
                <!-- Les boutons de tags seront ajoutés ici par JavaScript -->
            </div>
        </div>

        <div class="search-bar-section">
            <label for="search-task">Rechercher une tâche:</label>
            <input type="text" id="search-task" placeholder="Mot-clé...">
        </div>

        <div class="filter-section">
            <h2>État des tâches</h2>
            <div class="filters">
                <label for="filter-all">
                    <input type="radio" id="filter-all" name="filter" value="all" checked> Tous
                </label>
                <label for="filter-done">
                    <input type="radio" id="filter-done" name="filter" value="done"> Faits
                </label>
                <label for="filter-pending">
                    <input type="radio" id="filter-pending" name="filter" value="pending"> À faire
                </label>
            </div>
        </div>

        <div class="filter-section">
            <h2>Horaires</h2>
            <div class="filters">
                <label for="time-all">
                    <input type="radio" id="time-all" name="time" value="all" checked> Tous les horaires
                </label>
                <label for="time-morning">
                    <input type="radio" id="time-morning" name="time" value="morning"> Matin
                </label>
                <label for="time-8h">
                    <input type="radio" id="time-8h" name="time" value="8h"> 8h
                </label>
                <label for="time-10h45">
                    <input type="radio" id="time-10h45" name="time" value="10h45"> 10h45
                </label>
                 <label for="time-12h15">
                    <input type="radio" id="time-12h15" name="time" value="12h15"> 12h15
                </label>
                 <label for="time-15h">
                    <input type="radio" id="time-15h" name="time" value="15h"> 15h
                </label>
            </div>
        </div>

        <ul id="checklist">
            <!-- La checklist sera ajoutée ici par JavaScript -->
        </ul>
    </div>

    <!-- The Modal for Tag Input -->
    <div id="tagInputModal" class="tag-modal">
        <div class="tag-modal-content">
            <span class="close-button">×</span>
            <input type="text" id="tagInputText" placeholder="Entrez un tag">
            <button class="save-tag" id="saveTagButton">Enregistrer</button>
            <button class="cancel-tag" id="cancelTagButton">Annuler</button>
        </div>
    </div>


    <!-- Import Firebase SDK (compat pour faciliter la transition) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

    <script>

        // Fonction pour corriger les caractères spéciaux
        function fixCharacters(text) {
            return text.replace(/œ/g, 'oe')
                       .replace(/ç/g, 'c')
                       .replace(/é/g, 'e')
                       .replace(/è/g, 'e')
                       .replace(/à/g, 'a')
                       .replace(/ù/g, 'u')
                       .replace(/î/g, 'i')
                       .replace(/ê/g, 'e')
                       .replace(/â/g, 'a');
        }


        // Votre configuration Firebase
        const firebaseConfig = {
          apiKey: "AIzaSyDMDWEaNGj2grS0qn5b5phspZuNNFBU4qA",
          authDomain: "check-list-ebe53.firebaseapp.com",
          projectId: "check-list-ebe53",
          storageBucket: "check-list-ebe53.firebasestorage.app",
          messagingSenderId: "254086418316",
          appId: "1:254086418316:web:f5b8db7c20bf7dac5250a9",
          measurementId: "G-10QYMZ6HZ1"
        };

        let app;
        let database;
        let checklistRef;
        let snapshotData; // Stocke les données globales pour la fonction displayChecklist

        try {
            // Initialisation de Firebase
            app = firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            checklistRef = database.ref('checklist');
        } catch (error) {
            console.error("Erreur lors de l'initialisation de Firebase:", error);
            alert("Erreur lors du chargement de Firebase. Veuillez vérifier la console.");
        }

        const checklistElement = document.getElementById('checklist');
        const filterAll = document.getElementById('filter-all');
        const filterDone = document.getElementById('filter-done');
        const filterPending = document.getElementById('filter-pending');

        const timeAll = document.getElementById('time-all');
        const timeMorning = document.getElementById('time-morning');
        const time8h = document.getElementById('time-8h');
        const time10h45 = document.getElementById('time-10h45');
        const time12h15 = document.getElementById('time-12h15');
        const time15h = document.getElementById('time-15h');
        const searchInput = document.getElementById('search-task');
        const tagFiltersElement = document.getElementById('tag-filters');

        const tagInputModal = document.getElementById('tagInputModal');
        const tagInputText = document.getElementById('tagInputText');
        const saveTagButton = document.getElementById('saveTagButton');
        const cancelTagButton = document.getElementById('cancelTagButton');


        let currentTaskKeyForTagging = null; // Variable pour stocker la clé de la tâche à tagger


        function displayChecklist(data) {
            console.log("➡️➡️➡️ DÉBUT displayChecklist, data reçues :", data); // NOUVEAU LOG AU DÉBUT
            checklistElement.innerHTML = '';
            const filter = document.querySelector('input[name="filter"]:checked').value;
            const timeFilter = document.querySelector('input[name="time"]:checked').value;
            const searchTerm = searchInput.value.toLowerCase();
            const tagFilter = document.querySelector('input[name="tag-filter"]:checked').value;

            console.log("Filtre d'état sélectionné:", filter);
            console.log("Filtre horaire sélectionné:", timeFilter);
            console.log("Terme de recherche:", searchTerm);
            console.log("Filtre Tag sélectionné:", tagFilter);

            if (!data) { // ⚠️ AJOUTE CETTE VÉRIFICATION IMPORTANTE
                console.log("⚠️⚠️⚠️ ATTENTION : Aucune donnée reçue dans displayChecklist ! Data est null ou undefined."); // NOUVEAU LOG SI DATA EST VIDE
                checklistElement.innerHTML = '<p>Aucune tâche à afficher.</p>'; // Affiche un message si pas de données
                return; // ⚠️ IMPORTANT : Arrête la fonction ici si pas de données
            }


            for (const key in data) {
                if (data.hasOwnProperty(key)) {
                    const item = data[key];
                    const taskTextLower = item.text.toLowerCase();

                    console.log("Tâche:", key, item); // Laisse ce log, il est utile

                    // Filtrage par état (fait/à faire)
                    if (filter === 'done' && !item.checked) {
                        console.log("Filtrage - Tâche non faite, filtre 'faits' actif. Masquer:", key);
                        continue;
                    }
                    if (filter === 'pending' && item.checked) {
                        console.log("Filtrage - Tâche faite, filtre 'à faire' actif. Masquer:", key);
                        continue;
                    }

                    // Filtrage par horaire
                    if (timeFilter !== 'all' && item.time !== timeFilter) {
                        console.log("Filtrage - Horaire incorrect, filtre horaire actif. Masquer:", key);
                        continue;
                    }

                    // Filtrage par recherche
                    if (searchTerm && !taskTextLower.includes(searchTerm)) {
                        console.log("Filtrage - Terme de recherche non trouvé. Masquer:", key);
                        continue;
                    }

                    // Filtrage par tag
                    if (tagFilter !== 'all') {
                        if (!item.tags || !item.tags.includes(tagFilter)) { // Vérifie si la tâche a des tags et si le tag sélectionné est parmi eux
                            console.log("Filtrage - Tag incorrect, filtre tag actif. Masquer:", key);
                            continue;
                        }
                    }


                    const listItem = document.createElement('li');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.checked;
                    checkbox.id = key;

                    checkbox.addEventListener('change', () => {
                        database.ref(`checklist/${key}/checked`).set(checkbox.checked);
                    });

                    const label = document.createElement('label');
                    label.htmlFor = key;
                    label.textContent = fixCharacters(item.text);

                    const tagButton = document.createElement('button');
                    tagButton.classList.add('tag-button');
                    tagButton.textContent = 'Tag';
                    tagButton.addEventListener('click', () => {
                        currentTaskKeyForTagging = key; // Stocke la clé de la tâche actuelle
                        tagInputModal.style.display = "block"; // Affiche le modal
                        tagInputText.value = ""; // Réinitialise le champ de texte
                        tagInputText.focus(); // Focus sur l'input
                    });

                    const taskTagsSpan = document.createElement('span');
                    taskTagsSpan.classList.add('task-tags');
                    taskTagsSpan.textContent = item.tags ? item.tags.join(', ') : ''; // Affiche les tags s'il y en a

                    const taskContent = document.createElement('div'); // Div pour grouper checkbox et label à gauche
                    taskContent.style.display = 'flex';
                    taskContent.style.alignItems = 'center';
                    taskContent.appendChild(checkbox);
                    taskContent.appendChild(label);


                    listItem.appendChild(taskContent);
                    listItem.appendChild(taskTagsSpan); // Affiche les tags à côté du bouton Tag
                    listItem.appendChild(tagButton); // Ajoute le bouton Tag à droite
                    checklistElement.appendChild(listItem);
                }
            }
            console.log("⬅️⬅️⬅️ FIN displayChecklist"); // NOUVEAU LOG À LA FIN
        }

        // Fonction pour générer les boutons de tags
        function generateTagFilters(data) {
            const tags = new Set(); // Utilise un Set pour obtenir des tags uniques
            for (const key in data) {
                if (data.hasOwnProperty(key) && data[key].tags) {
                    data[key].tags.forEach(tag => tags.add(tag));
                }
            }

            tagFiltersElement.innerHTML = `
                <label for="tag-all">
                    <input type="radio" id="tag-all" name="tag-filter" value="all" checked> Tous les tags
                </label>
            `; // Réinitialise et ajoute le bouton "Tous les tags"

            tags.forEach(tag => {
                const label = document.createElement('label');
                label.htmlFor = `tag-${tag}`;
                label.innerHTML = `<input type="radio" id="tag-${tag}" name="tag-filter" value="${tag}"> ${tag}`;
                tagFiltersElement.appendChild(label);
            });

             // Ajoute les event listeners pour les nouveaux boutons de tag
            document.querySelectorAll('input[name="tag-filter"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    updateActiveFilter('tag-filter');
                    displayChecklist(snapshotData); // Réaffiche la checklist après changement de filtre tag
                });
            });
        }


        // Écoute les changements dans la base de données et met à jour la checklist
        checklistRef.on('value', (snapshot) => {
            snapshotData = snapshot.val(); // Stockage du snapshot dans la portée extérieure
            if (snapshotData) {
                displayChecklist(snapshotData);
                generateTagFilters(snapshotData); // Génère les boutons de tag après avoir récupéré les données
            } else {
                // Si la checklist est vide dans Firebase, on ajoute la nouvelle liste (à commenter/supprimer après la première mise à jour)
                /*
                const initialData = {
                    task1: { text: "s'assurer qu'il n'y ait jamais de cuisson à la boulangerie de nos produits en même temps que les leurs (dans le grand four)", checked: false, time: "morning", tags: ["boulangerie", "four"] },
                    task2: { text: "Allumer le four pour les pains et viennoiserie", checked: false, time: "morning", tags: ["boulangerie", "four"] },
                    task3: { text: "contrôler la provenance des légumes et la découpe (tomates, pommes de terre, legumes sautés.)", checked: false, time: "morning", tags: ["légumes", "découpe"] },
                    task4: { text: "allumer le feu pour la cuisson des légumes du petit déjeuner", checked: false, time: "morning", tags: ["légumes", "petit-déjeuner"] },
                    task5: { text: "Contrôler bien la poêle et la pince qui va servir à la cuisson des omelettes", checked: false, time: "morning", tags: ["omelettes", "matériel"] },
                    task6: { text: "contrôler la découpe des petits ingrédients qui vont servir aux omelettes comme les oignons les champignon.... *(ceci doivent être coupés absolument avec un couteau de lait)*", checked: false, time: "morning", tags: ["omelettes", "découpe", "lait"] },
                    task7: { text: "s'assurer que la découpe des fromages se fait sur un endroit neutre avec notre couteau", checked: false, time: "morning", tags: ["fromage", "découpe", "couteau"] },
                    task8: { text: "s'assurer qu'il y a bien uniquement du lait chamour sur le buffet et pour les cafés", checked: false, time: "morning", tags: ["lait", "buffet", "café"] },
                    task9: { text: "faire un tour du restaurant et vérifier la vaisselle (mais vous m'avez pas encore dit qu'est-ce que vous avez fixé pour les vaisselles les viandes)", checked: false, time: "morning", tags: ["vaisselle", "restaurant"] },
                    task10: { text: "également ouvrir les armoires et les tiroir des meubles et s'assurer qu'il n'y a pas d'autre vaisselle non cacher à proximité pourrais prêter à confusion (et être sortie pendant le service sans faire exprès)", checked: false, time: "morning", tags: ["vaisselle", "rangement"] },
                    task11: { text: "commencer à casser les œeufs (nettoyer et tout jeter après avoir fini)", checked: false, time: "morning", tags: ["oeufs", "préparation"] },
                    task12: { text: "vérifier que la machine et les filtres sont propres pour la vaisselle", checked: false, time: "morning", tags: ["vaisselle", "machine", "filtres"] },
                    task13: { text: "faire un tour du buffet du petit-déjeuner prêter attention à tout produit", checked: false, time: "morning", tags: ["buffet", "petit-déjeuner", "vérification"] },
                    task14: { text: "Valider les céréales et les granola si ils en sortent", checked: false, time: "morning", tags: ["céréales", "granola", "validation"] },
                    task15: { text: "s'assurer que les jus de fruits ne sont pas des jus CERET", checked: false, time: "morning", tags: ["jus de fruits", "CERET", "vérification"] },
                    task16: { text: "allumer le grand four ainsi que la crêpière et les gaufres", checked: false, time: "morning", tags: ["four", "crêpière", "gaufres"] },
                    task17: { text: "allumer le feu pour les omelettes (rappeler à la dame des omelettes que si il s'éteint seul vous deviez le rallumer)", checked: false, time: "morning", tags: ["omelettes", "feu"] },
                    task18: { text: "préciser à la dame des omelettes que si un client demande un ceuf au plat spécial sans blanc ou autre.. et qu'elle souhaite sortir un ceuf que c'est bien seulement vous qui pouviez le vérifier!", checked: false, time: "morning", tags: ["omelettes", "œuf au plat", "vérification"] },
                    task19: { text: "S'assurer qu'ils ont bien changé le lait du réservoir de machine à café", checked: false, time: "morning", tags: ["lait", "machine à café", "vérification"] },
                    task20: { text: "Passer à la cuisine de froid faire le point total de tout le menu des salades de shabbat avec Raya et s'assurer qu'il les cuit bien dans sa cuisine ou au boat house (attention à la différence entre les éléments de cuisson à faire sauter et se faire griller au four)", checked: false, time: "8h", tags: ["cuisine froide", "salades", "shabbat"] },
                    task21: { text: "Raya peut avoir besoin aussi bien de pâtes pommes de terre bouillie ainsi que toutes sortes de légumes sautées grillé au four il a également besoin parfois de petits croûtons de pain ainsi que du pain de mie ou des mini Pitot", checked: false, time: "8h", tags: ["cuisine froide", "ingrédients", "Raya"] },
                    task22: { text: "Raya a également la responsabilité de faire griller les pains pour le cocktail de chabat *faire bien attention qu'il emploie uniquement nos baguettes et dans notre timing de four*", checked: false, time: "8h", tags: ["cuisine froide", "pain", "cocktail", "shabbat", "Raya"] },
                    task23: { text: "Après avoir passé de kemias se renseigner sur le buffet du lendemain midi", checked: false, time: "8h", tags: ["kemias", "buffet", "midi"] },
                    task24: { text: "Jeter un coup d'ceil sur les produits utilisés dans la cuisine froide", checked: false, time: "8h", tags: ["cuisine froide", "produits", "vérification"] },
                    task25: { text: "jeter un coup d'œeil rapidement sur les couteaux", checked: false, time: "8h", tags: ["cuisine froide", "couteaux", "vérification"] },
                    task26: { text: "faire un point avec Raya sur les salades cuisinées qu'il souhaite mettre sur le buffet", checked: false, time: "8h", tags: ["cuisine froide", "salades", "buffet", "Raya"] },
                    task27: { text: "Fair un tour au boat house -> allumer le feux", checked: false, time: "8h", tags: ["boat house", "feu"] },
                    task28: { text: "Interroger charma sur le menu de midiet voir avec Vanessa celui du soir", checked: false, time: "8h", tags: ["menu", "midi", "soir", "Charma", "Vanessa"] },
                    task29: { text: "Un tour des produits vite fait", checked: false, time: "8h", tags: ["produits", "vérification"] },
                    task30: { text: "Un tour des viandes au congélateur", checked: false, time: "8h", tags: ["viandes", "congélateur", "vérification"] },
                    task31: { text: "Interroger le chef pâtissier si tout va bien et si il a besoin qu'on lui valide un produit", checked: false, time: "8h", tags: ["chef pâtissier", "produits", "validation"] },
                    task32: { text: "Interroger le pâtissier sur les mises en place anticipées dans la chambre froide", checked: false, time: "8h", tags: ["pâtissier", "mises en place", "chambre froide"] },
                    task33: { text: "Interroger également le patissier sur les desserts de samedi soir -> tout doit être produit vendredi", checked: false, time: "8h", tags: ["pâtissier", "desserts", "samedi soir", "production"] },
                    task34: { text: "passer avec sanjai à la poissonnerie pour valider les poissons de chabat, les salades du buffet, le cocktail et le BBQ du samedi soir", checked: false, time: "8h", tags: ["poissonnerie", "poissons", "salades", "buffet", "cocktail", "BBQ", "shabbat", "Sanjai"] },
                    task35: { text: "rappeler à la dame qui fait des crêpes qu'elle doit en faire quelques-unes pour shabbat idem pour les gaufres et voir avec David pour les omelettes", checked: false, time: "8h", tags: ["crêpes", "gaufres", "shabbat", "David", "rappel"] },
                    task36: { text: "normalement si il reste des légumes au petit-déjeuner on devrait les ressortir pour le lendemain sinon il faut les préparer sur place à l'extérieur avant de finaliser le petit déjeuner", checked: false, time: "8h", tags: ["légumes", "petit-déjeuner", "réutilisation"] },
                    task37: { text: "interroger après le petit-déjeuner où se trouve la poêle les pinces de lait (ceci doivent être mis de côté et *pas rapportées à la cuisine*)", checked: false, time: "8h", tags: ["petit-déjeuner", "matériel", "lait", "poêle", "pinces"] },
                    task38: { text: "Faire attention à la préparation du poisson gravelax du samedi matin (ou il est coupé et préparé)", checked: false, time: "8h", tags: ["poisson", "gravelax", "samedi matin", "préparation"] },
                    task39: { text: "Voir avec le boulanger à quel moment il souhaite faire les Halot (normalement autour de 13h)", checked: false, time: "10h45", tags: ["boulanger", "Halot", "timing"] },
                    task40: { text: "Tour au boat house", checked: false, time: "10h45", tags: ["boat house", "tour"] },
                    task41: { text: "vérifier toutes les salades vertes du jour et de chabat midi et samedi soir", checked: false, time: "10h45", tags: ["salades vertes", "shabbat", "midi", "soir", "vérification"] },
                    task42: { text: "Se renseigner combien d'invités arrivent le jour même et faire envoyer avec le room service une chaussure en chocolat avec un petit mot qui informe que c'est cacher", checked: false, time: "10h45", tags: ["room service", "chaussure en chocolat", "invités", "cacher"] },
                    task43: { text: "allumer le barbecue au déjeuner", checked: false, time: "10h45", tags: ["barbecue", "déjeuner"] },
                    task44: { text: "Passer au boat house et marquer tous les plats qui s'apprêtent à partir au buffet", checked: false, time: "10h45", tags: ["boat house", "plats", "buffet", "marquage"] },
                    task45: { text: "Voir avec Vanessa si elle a besoin de date ou autre pour la cuisson", checked: false, time: "10h45", tags: ["Vanessa", "cuisson", "dates"] },
                    task46: { text: "Allumer la machine à crêpes pour gouter et vérifier les jus (aucun de la marque CERET n'est cacher)", checked: false, time: "12h15", tags: ["machine à crêpes", "jus", "CERET", "vérification", "goûter"] },
                    task47: { text: "Faire un nouveau un tour au boat house", checked: false, time: "12h15", tags: ["boat house", "tour"] },
                    task48: { text: "Faire un tour à la pâtisserie de la cuisine centrale (reprendre note sur l'avancement des desserts bien les connaître", checked: false, time: "12h15", tags: ["pâtisserie", "cuisine centrale", "desserts", "vérification"] },
                    task49: { text: "Mise en place de la synagogue", checked: false, time: "12h15", tags: ["synagogue", "mise en place"] },
                    task50: { text: "voir avec richina sur le matériel qu'il a besoin pour les plats de shabbat ça peut être le bol à Bouillon ainsi que le bol à couscous les louches.", checked: false, time: "12h15", tags: ["Richina", "matériel", "shabbat", "plats", "synagogue"] },
                    task51: { text: "Sortir les vins de shabbat (voir avec David ) et sortir jus de raisin", checked: false, time: "12h15", tags: ["vins", "shabbat", "jus de raisin", "David"] },
                    task52: { text: "mettre la Bouha au congélateur", checked: false, time: "12h15", tags: ["Bouha", "congélateur"] },
                    task53: { text: "Voir avec Vanessa pour la décoration de bougies de Chabbat", checked: false, time: "12h15", tags: ["Vanessa", "décoration", "bougies", "shabbat"] },
                    task54: { text: "anticiper et mettre une petite boîte d'allumettes de côté dans larmoir du sefer tora pour allumer la bougie de la havdala", checked: false, time: "12h15", tags: ["allumettes", "sefer tora", "havdala", "anticipation"] },
                    task55: { text: "vérifier la listd des pains du lendemain et demander le timing de production", checked: false, time: "12h15", tags: ["pains", "lendemain", "timing", "production", "vérification"] },
                    task56: { text: "S'assurer qu'on a du café en poudre", checked: false, time: "12h15", tags: ["café en poudre", "vérification"] },
                    task57: { text: "demander à Shanghai de l'eau bouillante a disposition -> Koumkoum--> vendredi soir derrière la salle - samedi matin au petit-déjeuner -et samedi midi à côté de la syna", checked: false, time: "12h15", tags: ["eau bouillante", "Koumkoum", "Shanghai", "synagogue"] },
                    task58: { text: "Voir avec Raya les bols qu'il va utiliser pour la kemia", checked: false, time: "12h15", tags: ["Raya", "bols", "kemia"] },
                    task59: { text: "Contrôler aluminium et papier sur les plaques de cuisson de la boulangerie( rappeler aux équipes de ne pas mélanger les cuissons dans le four)", checked: false, time: "12h15", tags: ["boulangerie", "plaques de cuisson", "aluminium", "papier", "contrôle"] },
                    task60: { text: "Faire un tour chambre chocolat ou il prépare aussi quelques de nos desserts", checked: false, time: "12h15", tags: ["chambre chocolat", "desserts", "tour"] },
                    task61: { text: "Faire un tour derrière La syna pour s'assurer que notre vaisselle de midi a bien été rangés dans notre storage (petit décompte à vue d'œeil serait idéal)", checked: false, time: "12h15", tags: ["synagogue", "vaisselle", "midi", "rangement", "vérification"] },
                    task62: { text: "Tour général au boat house: proposer aide, verif menus", checked: false, time: "15h", tags: ["boat house", "tour", "aide", "menus"] },
                    task63: { text: "cacheriser une armoire chauffante pour garder les plats chauds (très rapidement avec le chalumeau attention en résistance derrière les paroi en aluminium et les caoutchouc)", checked: false, time: "15h", tags: ["armoire chauffante", "cacheriser", "chalumeau"] },
                    task64: { text: "voir avec Shanghai où est-ce qu'il va brancher le Plata (en général dans son bureau )", checked: false, time: "15h", tags: ["Shanghai", "Plata", "branchement"] },
                    task65: { text: "passer et repasser et repasser chez Raya avec la liste du menu de la kemia et faire valider au fur et à mesure", checked: false, time: "15h", tags: ["Raya", "menu", "kemia", "validation"] },
                    task66: { text: "demander la liste des desserts du lendemain", checked: false, time: "15h", tags: ["desserts", "lendemain", "liste"] },
                    task67: { text: "interroger le pâtissier si certaines mises en place ont déja été faite et où se trouve-t-elle", checked: false, time: "15h", tags: ["pâtissier", "mises en place", "vérification"] },
                    task68: { text: "Passer a nouveau dans la cuisine du froid (produit, couteau ,nouveauté...)", checked: false, time: "15h", tags: ["cuisine froide", "produits", "couteaux", "vérification"] },
                    task69: { text: "Voir timings a quand est-ce qu'il est prévu de produire le reste des desserts", checked: false, time: "15h", tags: ["desserts", "timing", "production"] },
                    task70: { text: "interroger le room service pour s'assurer qu'ils ont bien envoyé les chaussures en chocolat dans les chambres", checked: false, time: "15h", tags: ["room service", "chaussures en chocolat", "vérification"] },
                    task71: { text: "Petit coup d'oeil dans le four boulanger *(tout les heur si possible)", checked: false, time: "15h", tags: ["four boulanger", "vérification"] },
                    task72: { text: "Faire un tour dans la production de sushi que tout se déroule bien dans nos ustensiles", checked: false, time: "15h", tags: ["sushi", "production", "ustensiles", "tour"] },
                    task73: { text: "Casser des ceufs pour la pâte a crêpes a la pâtisserie centrale Pour dimanche matin", checked: false, time: "15h", tags: ["oeufs", "pâte à crêpes", "pâtisserie centrale", "dimanche matin"] },
                    task74: { text: "revoir avec le pâtissier sur le menu de chaque dessert et les ingrédients (il se peut qu'il y ait de temps a autre que nouveauté)", checked: false, time: "15h", tags: ["pâtissier", "menu", "desserts", "ingrédients", "vérification"] },
                    task75: { text: "attention à l'occasion -> ne pas hésiter de rendre visite à la pâtisserie non kacher pour voir les productions qu'il mette en place (il se peut que parfois il termine sur notre buffet avec ou sans faire exprès)( surtout qu'ils ont que une journée pour préparer les desserts de midi vendredi soir samedi midi et samedi soir (..)", checked: false, time: "15h", tags: ["pâtisserie non kacher", "production", "buffet", "vérification"] },
                    task76: { text: "Vérifier de temps a autre il n'est pas de cuisson faite sans que le four ait été allumé", checked: false, time: "15h", tags: ["cuisson", "four", "vérification"] },
                    task77: { text: "Faire un tour à la cuisine du froid pour la mise en place des dernières salades du soir", checked: false, time: "15h", tags: ["cuisine froide", "salades", "soir", "tour"] },
                    task78: { text: "Contrôler la mise en place du dîner: les couverts - les assiettes de dessert, des tasses à café, des petites cuillères, boisson fraîche qui vont être servi, les plats de salade, les pinces et le matériel de service qui va être utilisé dans le couloir, les soupières pour le couscous et pour la sauce, les louches ou cuillère qui vont être utilisées, les salières autorisées pour shabbat, et tout ce que je me rappelle pas qu'il faut faire attention", checked: false, time: "15h", tags: ["dîner", "mise en place", "matériel"] },
                    task79: { text: "Rallumer po", checked: false, time: "15h", tags: ["po", "rallumer"] },
                    task80: { text: "vérifier que les gastro et le matériel de cuisine sont marqués de rouge", checked: false, time: "15h", tags: ["matériel de cuisine", "gastro", "marquage", "vérification"] },
                    task81: { text: "Attention des fois ils peuvent avoir besoin de mini casseroles ou couteaux à la dernière minute -> a recup à la cuisine centrale", checked: false, time: "15h", tags: ["matériel", "cuisine centrale", "urgence"] },
                    task82: { text: "interroger Richna sur le lieu exact ou sera fait la vaisselle", checked: false, time: "15h", tags: ["Richna", "vaisselle", "lieu"] },
                    task83: { text: "Après le repas bien ramasser une bouteille de vin ouverte et de prendre avec vous les non mevouchal)", checked: false, time: "15h", tags: ["vin", "non mevouchal", "ramassage"] }
                };
                checklistRef.set(initialData);
                */
            }
        });

        // Fonction updateActiveFilter et les event listeners pour les filtres (restent les mêmes)
        function updateActiveFilter(filterName) {
            const labels = document.querySelectorAll(`label[for^="${filterName}"]`);
            labels.forEach(label => label.classList.remove('active'));
            const selectedRadio = document.querySelector(`input[name="${filterName}"]:checked`);
            if (selectedRadio) {
                const label = document.querySelector(`label[for="${selectedRadio.id}"]`);
                if (label) {
                    label.classList.add('active');
                }
            }
        }


        // Écoute les changements sur les radios de filtre pour mettre à jour la classe 'active'
        document.querySelectorAll('input[name="filter"]').forEach(radio => {
            radio.addEventListener('change', () => {
                updateActiveFilter('filter');
                displayChecklist(snapshotData);
            });
        });

         document.querySelectorAll('input[name="time"]').forEach(radio => {
            radio.addEventListener('change', () => {
                updateActiveFilter('time');
                displayChecklist(snapshotData);
            });
        });

        document.querySelectorAll('input[name="tag-filter"]').forEach(radio => {
            radio.addEventListener('change', () => {
                updateActiveFilter('tag-filter');
                displayChecklist(snapshotData);
            });
        });


         updateActiveFilter('filter');
         updateActiveFilter('time');
         updateActiveFilter('tag-filter');


        let snapshotData; // Variable pour stocker le snapshot Firebase en dehors du listener

        checklistRef.on('value', (snap) => {
            snapshotData = snap.val();
            if (snapshotData) {
                displayChecklist(snapshotData);
                generateTagFilters(snapshotData);
            }
        });

        // Écoute les changements dans la barre de recherche
        searchInput.addEventListener('input', () => {
            displayChecklist(snapshotData);
        });


        // Modal interaction
        const closeModalButtons = document.querySelectorAll('.close-button, #cancelTagButton');
        closeModalButtons.forEach(button => {
            button.addEventListener('click', () => {
                tagInputModal.style.display = "none";
            });
        });

        window.addEventListener('click', (event) => {
            if (event.target == tagInputModal) {
                tagInputModal.style.display = "none";
            }
        });

        saveTagButton.addEventListener('click', () => {
            const tagText = tagInputText.value.trim();
            if (tagText && currentTaskKeyForTagging) {
                const tagArray = tagText.split(',').map(tag => tag.trim()).filter(tag => tag !== ''); // Permet d'ajouter plusieurs tags séparés par des virgules

                checklistRef.child(currentTaskKeyForTagging).child('tags').set(tagArray).then(() => {
                    tagInputModal.style.display = "none";
                    currentTaskKeyForTagging = null; // Réinitialise la clé de tâche
                }).catch(error => {
                    console.error("Erreur lors de la sauvegarde du tag:", error);
                    alert("Erreur lors de la sauvegarde du tag.");
                });
            } else {
                alert("Veuillez entrer un tag.");
            }
        });


    </script>
</body>
</html>
