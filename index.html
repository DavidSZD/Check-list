<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist Partagée - Vendredi</title>
    <style> /* (CSS reste le même) */ </style>
</head>
<body>
    <h1>Checklist Partagée - Vendredi</h1>

    <div class="container">
        <!-- (Filtres et UL restent les mêmes) -->
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-database-compat.js"></script>

    <script>
        // (Fonction fixCharacters reste la même)

        const firebaseConfig = {
          apiKey: "AIzaSyDMDWEaNGj2grS0qn5b5phspZuNNFBU4qA",
          authDomain: "check-list-ebe53.firebaseapp.com",
          projectId: "check-list-ebe53",
          storageBucket: "check-list-ebe53.firebasestorage.app",
          messagingSenderId: "254086418316",
          appId: "1:254086418316:web:f5b8db7c20bf7dac5250a9",
          measurementId: "G-10QYMZ6HZ1"
        };

        let app;
        let database;
        let checklistRef;
        let allTasks = {}; // Stocke toutes les tâches chargées depuis Firebase

        try {
            // Initialisation de Firebase
            app = firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            checklistRef = database.ref('checklist');
        } catch (error) {
            console.error("Erreur lors de l'initialisation de Firebase:", error);
            alert("Erreur lors du chargement de Firebase. Veuillez vérifier la console.");
        }

        const checklistElement = document.getElementById('checklist');

        function displayChecklist(data) {
            checklistElement.innerHTML = '';
            const filter = document.querySelector('input[name="filter"]:checked').value;
            const timeFilter = document.querySelector('input[name="time"]:checked').value;

            for (const key in data) {
                if (data.hasOwnProperty(key)) {
                    const item = data[key];
                    if (filter === 'done' && !item.checked) continue;
                    if (filter === 'pending' && item.checked) continue;
                    if (timeFilter !== 'all' && item.time !== timeFilter) continue;

                    const listItem = document.createElement('li');
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.checked = item.checked;
                    checkbox.id = key;

                    checkbox.addEventListener('change', () => {
                        database.ref(`checklist/${key}/checked`).set(checkbox.checked);
                        // Mise à jour de l'état checked dans allTasks
                        allTasks[key].checked = checkbox.checked;
                    });

                    const label = document.createElement('label');
                    label.htmlFor = key;
                    label.textContent = fixCharacters(item.text);

                    listItem.appendChild(checkbox);
                    listItem.appendChild(label);
                    checklistElement.appendChild(listItem);
                }
            }
        }

        // Écoute les changements dans la base de données et met à jour la checklist
        checklistRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                // Stockage de toutes les tâches dans allTasks
                allTasks = data;
                displayChecklist(data);
            } else {
                // Si la checklist est vide dans Firebase, on ajoute la nouvelle liste (à ne faire qu'une seule fois!)
                // ... [Insère ici ton initialData complet comme dans la réponse précédente] ...
                // checklistRef.set(initialData); // A décommenter pour l'initialisation
            }
        });

        // Gestion des filtres
        const filterAll = document.getElementById('filter-all');
        const filterDone = document.getElementById('filter-done');
        const filterPending = document.getElementById('filter-pending');

        const timeAll = document.getElementById('time-all');
        const timeMorning = document.getElementById('time-morning');
        const time8h = document.getElementById('time-8h');
        const time10h45 = document.getElementById('time-10h45');
        const time12h15 = document.getElementById('time-12h15');
        const time15h = document.getElementById('time-15h');

        filterAll.addEventListener('change', () => displayChecklist(allTasks));
        filterDone.addEventListener('change', () => displayChecklist(allTasks));
        filterPending.addEventListener('change', () => displayChecklist(allTasks));

        timeAll.addEventListener('change', () => displayChecklist(allTasks));
        timeMorning.addEventListener('change', () => displayChecklist(allTasks));
        time8h.addEventListener('change', () => displayChecklist(allTasks));
        time10h45.addEventListener('change', () => displayChecklist(allTasks));
        time12h15.addEventListener('change', () => displayChecklist(allTasks));
        time15h.addEventListener('change', () => displayChecklist(allTasks));

         function updateActiveFilter(filterName) {
            const labels = document.querySelectorAll(`label[for^="${filterName}"]`); // Sélectionne tous les labels dont l'attribut 'for' commence par 'filter'
            labels.forEach(label => label.classList.remove('active')); // Supprime la classe 'active' de tous les labels
            const selectedRadio = document.querySelector(`input[name="${filterName}"]:checked`); // Sélectionne le bouton radio sélectionné
            if (selectedRadio) {
                const label = document.querySelector(`label[for="${selectedRadio.id}"]`); // Trouve le label correspondant
                if (label) {
                    label.classList.add('active'); // Ajoute la classe 'active' au label sélectionné
                }
            }
        }


        // Écoute les changements sur les radios de filtre pour mettre à jour la classe 'active'
        document.querySelectorAll('input[name="filter"]').forEach(radio => {
            radio.addEventListener('change', () => {
                updateActiveFilter('filter');
            });
        });

         document.querySelectorAll('input[name="time"]').forEach(radio => {
            radio.addEventListener('change', () => {
                updateActiveFilter('time');
            });
        });

         updateActiveFilter('filter');
         updateActiveFilter('time');

    </script>
</body>
</html>
